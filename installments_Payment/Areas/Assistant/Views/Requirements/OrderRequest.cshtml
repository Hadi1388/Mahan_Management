@model installments_Payment.Core.ViewModels.Inventory.RequirementsViewModel

@{
    ViewData["Title"] = "ثبت سفارش جدید";
}

<div class="container">
    <form asp-action="OrderRequest" method="post">
        <span asp-validation-summary="All" class="text-danger"></span>

        <div class="card bg-secondary bg-opacity-25 rounded-5 mt-2">
            <div class="card-body">
                <div class="">
                    <input type="text" id="searchBox" class="form-control rounded-5" placeholder="جستجوی کالا..." />
                </div>
            </div>
        </div>

        <hr class="mt-2" />

        @if (!Model.RequirementsItems.Any())
        {
            <div class="alert btn-gradient-yellow text-center text-black-50 rounded-2 mt-2">
                کالایی برای نمایش وجود ندارد
            </div>
        }

        else
        {
            <div class="card mt-2">
                <div class="card-body">
                    <table class="table table-bordered table-striped shadow mt-3">
                        <thead class="table-success">
                            <tr>
                                <th>انتخاب</th>
                                <th>نام کالا</th>
                                <th>تعداد</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.RequirementsItems.Count; i++)
                            {
                                <tr>
                                    <td>
                                        <input asp-for="RequirementsItems[i].IsSelected" type="checkbox" />
                                        <span asp-validation-for="RequirementsItems[@i].IsSelected" class="text-danger"></span>
                                    </td>
                                    <td>
                                        @Model.RequirementsItems[i].CommodityName
                                        <input type="hidden" asp-for="RequirementsItems[@i].CommodityId" />
                                        <input type="hidden" asp-for="RequirementsItems[@i].CommodityName" />
                                    </td>
                                    <td>
                                        <input asp-for="RequirementsItems[@i].Quantity" class="form-control" type="number" min="0" value="0" />
                                        <span asp-validation-for="RequirementsItems[@i].Quantity" class="text-danger"></span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <!-- پیام هشدار زیر جدول -->
                    <p id="notFoundMessage" class="alert btn-gradient-yellow rounded-2 text-black-50 text-center mt-2 d-none">
                        هیچ کالایی یافت نشد
                    </p>
                </div>
            </div>

        }
        <hr class="mt-3" />
        <div class="d-flex justify-content-end mt-2">
            <button type="submit" class="bg-gradient-to-r from-green-primary to-green-dark text-white px-4 py-2 rounded-full font-medium hover:opacity-90 transitionn">ثبت سفارش</button>
            <a asp-action="Index" class="btn-gradient-gray ms-0 mx-1">بازگشت</a>
        </div>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchBox = document.getElementById("searchBox");
        const tableRows = document.querySelectorAll("table tbody tr");
        const notFoundMessage = document.getElementById("notFoundMessage");

        searchBox.addEventListener("input", function () {
            const query = this.value.toLowerCase();
            let found = false;

            tableRows.forEach(row => {
                const commodityName = row.cells[1].innerText.toLowerCase();
                if (commodityName.includes(query)) {
                    row.style.display = "";
                    found = true;
                } else {
                    row.style.display = "none";
                }
            });

            // نمایش یا مخفی کردن پیام
            if (!found && query.length > 0) {
                notFoundMessage.classList.remove("d-none");
            } else {
                notFoundMessage.classList.add("d-none");
            }
        });
    });
</script>
